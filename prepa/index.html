<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Examen Blanc Pr√©pa | The Exam Lab</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Fredoka', sans-serif;
            background: #1e74c7;
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Logo Section */
        .logo-section {
            text-align: center;
            padding: 60px 0 40px;
        }

        .logo-image {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            display: block;
        }

        /* Social Media Icons */
        .social-section {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 40px;
        }

        .social-icon {
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: white;
            font-size: 22px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .social-icon:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }

        .social-icon.instagram {
            background: linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%);
        }

        .social-icon.facebook {
            background: #1877f2;
        }

        .social-icon.youtube {
            background: #ff0000;
        }

        .social-icon.tiktok {
            background: #000000;
        }

        .social-icon.linkedin {
            background: #0077b5;
        }

        .social-icon.email {
            background: #34495e;
        }

        /* Navigation Menu */
        .nav-section {
            text-align: center;
            margin-bottom: 60px;
        }

        .nav-menu {
            display: flex;
            justify-content: center;
            gap: 50px;
            flex-wrap: wrap;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            font-weight: 600;
            font-size: 1.3rem;
            padding: 12px 25px;
            border-radius: 25px;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            transform: translateY(-2px);
        }

        /* Hero Section */
        .hero-section {
            text-align: center;
            margin-bottom: 80px;
            padding: 60px 0;
        }

        .hero-title {
            font-size: 4.5rem;
            color: white;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 30px;
        }

        .hero-subtitle {
            font-size: 1.8rem;
            color: white;
            font-weight: 500;
            line-height: 1.4;
        }

        /* Form Section */
        .form-section {
            background: white;
            border-radius: 20px;
            padding: 50px;
            margin-bottom: 60px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .task-question {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 40px;
            text-align: left;
            border: 2px solid #1e74c7;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .task-question h3 {
            color: #1e74c7;
            font-size: 1.4rem;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
        }

        .text-container {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            line-height: 1.6;
            font-size: 1rem;
        }

        .text-container h4 {
            color: #1e74c7;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .text-container p {
            margin-bottom: 15px;
            text-align: justify;
        }

        .task-instructions {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }

        .task-instructions p {
            color: #856404;
            font-weight: 500;
            line-height: 1.6;
        }

        .question-box {
            background: #e8f4fd;
            border: 2px solid #1e74c7;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .question-box p {
            color: #1e74c7;
            font-weight: 600;
            font-size: 1.05rem;
            line-height: 1.6;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1rem;
        }

        .required {
            color: #e74c3c;
        }

        input, textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #1e74c7;
            background: white;
            box-shadow: 0 0 0 3px rgba(30, 116, 199, 0.1);
            transform: translateY(-1px);
        }

        textarea {
            resize: vertical;
            min-height: 200px;
        }

        .verification-section {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }

        .verification-section h4 {
            color: #856404;
            margin-bottom: 15px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .phone-verification {
            display: flex;
            gap: 15px;
            align-items: end;
        }

        .phone-input {
            flex: 1;
        }

        .verify-btn {
            background: #ffc107;
            color: #856404;
            border: none;
            padding: 15px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .verify-btn:hover {
            background: #e0a800;
            transform: translateY(-1px);
        }

        .verify-btn:disabled {
            background: #d1ecf1;
            color: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .verification-code {
            margin-top: 15px;
            display: none;
        }

        .verification-code.show {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin: 20px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin: 0;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            line-height: 1.5;
            font-weight: 400;
        }

        .submit-btn {
            width: 100%;
            background: linear-gradient(135deg, #1e74c7 0%, #2b5ce6 100%);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            box-shadow: 0 8px 20px rgba(30, 116, 199, 0.3);
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(30, 116, 199, 0.4);
        }

        .submit-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            display: none;
            text-align: center;
        }

        .character-count {
            font-size: 0.9rem;
            color: #666;
            text-align: right;
            margin-top: 5px;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #1e74c7;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Examples Section */
        .examples-section {
            text-align: center;
            margin-bottom: 60px;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .examples-title {
            font-size: 2rem;
            color: #333;
            margin-bottom: 30px;
            font-weight: 600;
        }

        .examples-buttons {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
            padding: 0 20px;
        }

        .example-btn {
            background: linear-gradient(135deg, #1e74c7 0%, #2b5ce6 100%);
            color: white;
            border: none;
            padding: 25px 60px;
            border-radius: 15px;
            font-size: 1.3rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 8px 20px rgba(30, 116, 199, 0.3);
            min-width: 200px;
            text-align: center;
        }

        .example-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(30, 116, 199, 0.4);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 0;
            color: white;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .footer p {
            margin-bottom: 10px;
            color: #666;
        }

        .footer a {
            color: #1e74c7;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.5rem;
            }

            .hero-subtitle {
                font-size: 1.2rem;
            }

            .form-section {
                padding: 30px 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .phone-verification {
                flex-direction: column;
                align-items: stretch;
            }

            .nav-menu {
                gap: 20px;
            }

            .nav-link {
                font-size: 1rem;
                padding: 8px 16px;
            }

            .social-section {
                gap: 15px;
            }

            .social-icon {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }

            .logo-image {
                width: 120px;
                height: 120px;
            }

            .examples-buttons {
                flex-direction: column;
                align-items: center;
            }

            .example-btn {
                width: 250px;
                font-size: 1.2rem;
            }
        }

        /* Large screens - make elements even bigger */
        @media (min-width: 1400px) {
            .hero-title {
                font-size: 5.5rem;
            }

            .hero-subtitle {
                font-size: 2.2rem;
            }

            .nav-link {
                font-size: 1.5rem;
                padding: 15px 30px;
            }

            .logo-image {
                width: 250px;
                height: 250px;
            }

            .social-icon {
                width: 65px;
                height: 65px;
                font-size: 26px;
            }

            .nav-menu {
                gap: 60px;
            }

            .social-section {
                gap: 30px;
            }
        }

        /* Extra large screens */
        @media (min-width: 1800px) {
            .hero-title {
                font-size: 6.5rem;
            }

            .hero-subtitle {
                font-size: 2.6rem;
            }

            .nav-link {
                font-size: 1.7rem;
            }

            .logo-image {
                width: 300px;
                height: 300px;
            }

            .container {
                max-width: 1600px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Logo Section -->
        <div class="logo-section">
            <img src="logo.svg" alt="The Exam Lab" class="logo-image">
        </div>

        <!-- Social Media Icons -->
        <div class="social-section">
            <a href="https://instagram.com/theexamlab" class="social-icon instagram" target="_blank" title="Instagram">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                </svg>
            </a>
            <a href="https://facebook.com/theexamlab" class="social-icon facebook" target="_blank" title="Facebook">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
            </a>
            <a href="https://youtube.com/@theexamlab" class="social-icon youtube" target="_blank" title="YouTube">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                </svg>
            </a>
            <a href="https://tiktok.com/@theexamlab" class="social-icon tiktok" target="_blank" title="TikTok">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19.59 6.69a4.83 4.83 0 0 1-3.77-4.25V2h-3.45v13.67a2.89 2.89 0 0 1-5.2 1.74 2.89 2.89 0 0 1 2.31-4.64 2.93 2.93 0 0 1 .88.13V9.4a6.84 6.84 0 0 0-1-.05A6.33 6.33 0 0 0 5 20.1a6.34 6.34 0 0 0 10.86-4.43v-7a8.16 8.16 0 0 0 4.77 1.52v-3.4a4.85 4.85 0 0 1-1-.1z"/>
                </svg>
            </a>
            <a href="https://linkedin.com/company/theexamlab" class="social-icon linkedin" target="_blank" title="LinkedIn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
            </a>
            <a href="mailto:info@theexamlab.com" class="social-icon email" title="Email Us">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                </svg>
            </a>
        </div>

        <!-- Navigation Menu -->
        <div class="nav-section">
            <nav class="nav-menu">
                <a href="/about" class="nav-link">Qui Sommes-Nous</a>
                <a href="/exam-tips" class="nav-link">Astuces</a>
                <a href="/corrections" class="nav-link">Je veux des corrections</a>
                <a href="/classes" class="nav-link">Je veux des cours</a>
            </nav>
        </div>

        <!-- Hero Section -->
        <div class="hero-section">
            <h1 class="hero-title">Des connaissances en pr√©pa d'anglais que vous ne trouverez nulle part ailleurs.</h1>
            <p class="hero-subtitle">Essayez la r√©daction ci-dessous et nous vous enverrons nos commentaires directement dans votre bo√Æte mail.</p>
        </div>

        <!-- Form Section -->
        <div class="form-section">
            <div class="task-question">
                <h3>üìù √âpreuve √©crite</h3>
                <div class="text-container">
                    <p>Starting in January, Amazon for the first time will pay for tuition, fees and books for warehouse, transportation and other hourly employees who want to pursue bachelor's degrees. It will also begin covering high school diploma programs, *GEDs and English as a Second Language certifications for employees.</p>
                    <p>Amazon employees who have been with the company for at least 90 days are able to use the benefit, and employees must continue working part-time or full-time at Amazon while taking classes. Workers at Whole Foods, which Amazon owns, are not eligible. Its move to add four-year degrees to its package comes as rival employers such as Walmart and Target beef up their college benefit programs for workers.</p>
                    <p>Walmart said in July that it was dropping a previous $1 a day tuition fee paid by its workers who want to earn a degree at 10 academic partners and also begin covering the costs of their books. Walmart has around 1.5 million workers.</p>
                    <p>Target also said it will pay for full tuition and books for more than 340,000 workers at around 40 partner schools. Target also said it will pay up to $10,000 a year for master's programs within its network of partners.</p>
                    <p>Amazon's move also comes as retailers and warehouses around the country face challenges hiring employees to staff stores and warehouses. In July, there were 879,000 unfilled jobs in the retail industry and 222,000 in the transportation and warehouse industry, according to the latest data from the Bureau of Labor Statistics.</p>
                    <p>Amazon said in May that it was hiring 75,000 workers across its logistics network and bumping starting pay from its $15 minimum rate to an average of $17 an hour. The company is also offering sign-up bonuses of up to $1,000 for seasonal and warehouse workers, spending a total of more incentives," said Brian Olsavsky, Amazon's chief financial officer, in July. "It's a very competitive labor market out there. And certainly, the biggest contributor to inflationary pressures that we're seeing in the business."</p>
                    <p>Amazon also announced Thursday that it plans to retrain 300,000 employees for higher-skilled, fast-growing jobs within the company over the next four years, upping a prior pledge it made in 2019 to retrain 100,000 workers for new positions. Amazon offers internal training programs for roles such as software and IT engineers, data center technicians, and researchers and designers.</p>
                    <p>*GED = General Educational Development</p>
                    <p style="text-align: right; margin-top: 20px; font-style: italic;">Adapted from cnn.com September 9, 2021.</p>
                </div>
                <div class="question-box">
                    <p><strong>In your opinion, to what extent is it the role of private companies to finance higher education? Illustrate your answer with relevant examples. (180 words, ¬± 10 %)</strong></p>
                </div>
                <div class="task-instructions">
                    <p><strong>Instructions :</strong> R√©pondez √† la question ci-dessus en anglais. Votre r√©ponse doit faire environ 180 mots (¬± 10 %). Utilisez des exemples pertinents pour illustrer votre argumentation.</p>
                </div>
            </div>

            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Traitement de votre soumission...</p>
            </div>

            <form id="trialForm" onsubmit="handleSubmit(event)">
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">Pr√©nom <span class="required">*</span></label>
                        <input type="text" id="firstName" name="firstName" required maxlength="50">
                        <div class="error-message" id="firstNameError"></div>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Nom de famille <span class="required">*</span></label>
                        <input type="text" id="lastName" name="lastName" required maxlength="50">
                        <div class="error-message" id="lastNameError"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="email">Adresse email <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required>
                    <div class="error-message" id="emailError"></div>
                </div>

                <div class="verification-section">
                    <h4>üîê V√©rification t√©l√©phonique requise</h4>
                    <p>Pour √©viter les abus de notre service gratuit, nous demandons une v√©rification t√©l√©phonique. Votre num√©ro ne sera utilis√© que pour la v√©rification.</p>
                    
                    <div class="phone-verification">
                        <div class="phone-input">
                            <label for="phone">Num√©ro de t√©l√©phone <span class="required">*</span></label>
                            <input type="tel" id="phone" name="phone" placeholder="+33 6XX XX XX XX" required>
                            <div class="error-message" id="phoneError"></div>
                        </div>
                        <button type="button" class="verify-btn" id="verifyPhoneBtn" onclick="sendVerificationCode()">
                            Envoyer Code
                        </button>
                    </div>

                    <div class="verification-code" id="verificationCodeSection">
                        <label for="verificationCode">Code de v√©rification <span class="required">*</span></label>
                        <input type="text" id="verificationCode" name="verificationCode" placeholder="Entrez le code √† 6 chiffres" maxlength="6">
                        <div class="error-message" id="verificationError"></div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="workText">√âcrivez votre r√©ponse <span class="required">*</span></label>
                    <textarea 
                        id="workText" 
                        name="workText" 
                        placeholder="R√©pondez √† la question en anglais ici. Votre r√©ponse doit faire environ 180 mots et utiliser des exemples pertinents..."
                        required
                        rows="12"
                        maxlength="2500"
                        oninput="updateCharacterCount('workText', 'workTextCount', 2500)"
                    ></textarea>
                    <div class="character-count" id="workTextCount">0/2500 caract√®res (visez environ 180 mots)</div>
                    <div class="error-message" id="workTextError"></div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="terms" name="terms" required>
                    <label for="terms">En soumettant ce formulaire, j'accepte les <a href="/terms" target="_blank" style="color: #1e74c7;">Conditions G√©n√©rales</a>, je confirme que c'est la premi√®re fois que j'utilise ce service, et j'accepte de recevoir des conseils d'√©tude et des mises √† jour de The Exam Lab <span class="required">*</span></label>
                </div>

                <button type="submit" class="submit-btn" id="submitBtn" disabled>
                    Soumettre ma r√©ponse
                </button>
            </form>

            <div class="success-message" id="successMessage">
                <h3>üéâ Soumission r√©ussie !</h3>
                <p><strong>Merci d'avoir essay√© notre service !</strong></p>
                <p>Nous allons examiner votre r√©ponse et vous envoyer des commentaires d√©taill√©s par email dans les 24-48 heures.</p>
                <p style="margin-top: 15px; font-size: 0.9rem; color: #666;">Surveillez votre bo√Æte de r√©ception (et votre dossier spam) pour nos commentaires d'expert !</p>
            </div>
        </div>

        <!-- Examples Section -->
        <div class="examples-section">
            <h2 class="examples-title">D√©couvrez quelques exemples des commentaires d√©taill√©s que vous obtenez avec nos corrections payantes</h2>
            <div class="examples-buttons">
                <a href="/rac-example" class="example-btn">RAC</a>
                <a href="/essai-argumentatif-example" class="example-btn">Essai argumentatif</a>
                <a href="/colle-example" class="example-btn">Colle</a>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>&copy; 2025 The Exam Lab. Tous droits r√©serv√©s.</p>
            <p><a href="/terms">Conditions G√©n√©rales</a></p>
        </div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCgTKBwNhMWbh9BkIEAJvM8ytkjO3RjQE0",
            authDomain: "the-exam-lab-submission-form.firebaseapp.com",
            projectId: "the-exam-lab-submission-form",
            storageBucket: "the-exam-lab-submission-form.firebasestorage.app",
            messagingSenderId: "641333687658",
            appId: "1:641333687658:web:b204762b98de642bece113",
            measurementId: "G-YG744LCZL6"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Initialize EmailJS
        emailjs.init("iV9qk2kK_oY6mDeDk");

        let isPhoneVerified = false;
        let verificationId = null;

        // Auto-detect exam type from subdomain
        function getExamTypeFromDomain() {
            const hostname = window.location.hostname;
            if (hostname.includes('ielts.')) return 'IELTS';
            if (hostname.includes('prepa.')) return 'Pr√©pa';
            if (hostname.includes('first.')) return 'Cambridge First';
            if (hostname.includes('advanced.')) return 'Cambridge Advanced';
            if (hostname.includes('proficiency.')) return 'Cambridge Proficiency';
            return 'General';
        }

        // Send email notification
        async function sendEmailNotification(formData) {
            const examType = getExamTypeFromDomain();
            
            const templateParams = {
                to_email: 'henry@theexamlab.com',
                from_name: `${formData.firstName} ${formData.lastName}`,
                reply_to: formData.email,
                exam_type: examType,
                student_name: `${formData.firstName} ${formData.lastName}`,
                student_email: formData.email,
                student_phone: formData.phone,
                student_response: formData.workText,
                submission_date: new Date().toLocaleString('fr-FR')
            };

            try {
                console.log('Sending email with params:', templateParams);
                const response = await emailjs.send(
                    'service_19c8ix4',
                    'template_x5nlazu',
                    templateParams
                );
                console.log('Email sent successfully!', response);
                return true;
            } catch (error) {
                console.error('Failed to send email:', error);
                
                // Try without EmailJS as fallback - just store the data
                console.log('EmailJS failed, proceeding without email notification');
                return true; // Continue with submission even if email fails
            }
        }

        // Generate browser fingerprint (simplified to avoid size limits)
        function generateFingerprint() {
            const data = {
                ua: navigator.userAgent.substring(0, 100), // Truncate long user agents
                lang: navigator.language,
                platform: navigator.platform,
                screen: `${screen.width}x${screen.height}`,
                tz: Intl.DateTimeFormat().resolvedOptions().timeZone,
                ts: Math.floor(Date.now() / (1000 * 60 * 60)) // Hour precision
            };
            
            // Create a much shorter fingerprint
            const fingerprint = btoa(JSON.stringify(data)).substring(0, 50);
            return fingerprint;
        }

        // Check for previous submissions
        async function checkPreviousSubmission() {
            const fingerprint = generateFingerprint();
            const email = document.getElementById('email').value.trim().toLowerCase();
            const phone = document.getElementById('phone').value.trim();

            try {
                // Check by fingerprint
                const fingerprintQuery = await db.collection('submissions')
                    .where('fingerprint', '==', fingerprint)
                    .get();

                if (!fingerprintQuery.empty) {
                    showError('emailError', 'Il semble que vous ayez d√©j√† utilis√© notre service d\'essai gratuit depuis cet appareil.');
                    return false;
                }

                // Check by email
                if (email) {
                    const emailQuery = await db.collection('submissions')
                        .where('email', '==', email)
                        .get();

                    if (!emailQuery.empty) {
                        showError('emailError', 'Cette adresse email a d√©j√† √©t√© utilis√©e pour notre essai gratuit.');
                        return false;
                    }
                }

                // Check by phone
                if (phone) {
                    const phoneQuery = await db.collection('submissions')
                        .where('phone', '==', phone)
                        .get();

                    if (!phoneQuery.empty) {
                        showError('phoneError', 'Ce num√©ro de t√©l√©phone a d√©j√† √©t√© utilis√© pour notre essai gratuit.');
                        return false;
                    }
                }

                return true;
            } catch (error) {
                console.error('Error checking previous submissions:', error);
                return true;
            }
        }

        // Send SMS verification code using Firebase Auth
        async function sendVerificationCode() {
            const phone = document.getElementById('phone').value.trim();
            
            if (!phone) {
                showError('phoneError', 'Veuillez entrer votre num√©ro de t√©l√©phone');
                return;
            }
            
            // Basic validation - just check if it looks like a phone number
            const phoneRegex = /^[\+]?[\d\s\-\(\)]{10,20}$/;
            if (!phoneRegex.test(phone)) {
                showError('phoneError', 'Veuillez entrer un num√©ro de t√©l√©phone valide');
                return;
            }

            if (!(await checkPreviousSubmission())) {
                return;
            }

            const btn = document.getElementById('verifyPhoneBtn');
            btn.disabled = true;
            btn.textContent = 'Envoi...';

            try {
                let formattedPhone = phone.replace(/[\s\-\(\)]/g, '');
                
                // Add + if not present
                if (!formattedPhone.startsWith('+')) {
                    formattedPhone = '+' + formattedPhone;
                }

                window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('verifyPhoneBtn', {
                    size: 'invisible',
                    callback: function(response) {
                        console.log('reCAPTCHA verified');
                    }
                });

                const confirmationResult = await firebase.auth().signInWithPhoneNumber(
                    formattedPhone, 
                    window.recaptchaVerifier
                );
                
                verificationId = confirmationResult.verificationId;
                document.getElementById('verificationCodeSection').classList.add('show');
                
                btn.textContent = 'Code envoy√© !';
                btn.style.background = '#28a745';
                clearError('phoneError');

            } catch (error) {
                console.error('SMS Error:', error);
                btn.textContent = 'Envoyer Code';
                btn.disabled = false;
                
                if (error.code === 'auth/too-many-requests') {
                    showError('phoneError', 'Trop de tentatives. Veuillez r√©essayer plus tard.');
                } else if (error.code === 'auth/invalid-phone-number') {
                    showError('phoneError', 'Num√©ro de t√©l√©phone invalide. Assurez-vous d\'inclure l\'indicatif du pays.');
                } else {
                    showError('phoneError', 'Erreur lors de l\'envoi du code. Veuillez r√©essayer.');
                }
            }
        }

        // Verify the SMS code
        async function verifyCode(code) {
            if (!verificationId || !code) return false;

            try {
                const credential = firebase.auth.PhoneAuthProvider.credential(verificationId, code);
                await firebase.auth().signInWithCredential(credential);
                
                isPhoneVerified = true;
                document.getElementById('verificationCode').style.borderColor = '#28a745';
                clearError('verificationError');
                updateSubmitButton();
                
                return true;
            } catch (error) {
                console.error('Verification Error:', error);
                showError('verificationError', 'Code de v√©rification invalide');
                return false;
            }
        }

        // Handle form submission
        async function handleSubmit(event) {
            event.preventDefault();

            if (!(await checkPreviousSubmission())) {
                return;
            }

            const form = event.target;
            const submitBtn = document.getElementById('submitBtn');
            const loading = document.getElementById('loading');
            const successMessage = document.getElementById('successMessage');

            submitBtn.disabled = true;
            submitBtn.textContent = 'Soumission...';
            form.style.display = 'none';
            loading.style.display = 'block';

            try {
                const submissionId = db.collection('submissions').doc().id;
                
                const submissionData = {
                    id: submissionId,
                    firstName: document.getElementById('firstName').value.trim(),
                    lastName: document.getElementById('lastName').value.trim(),
                    email: document.getElementById('email').value.trim().toLowerCase(),
                    phone: document.getElementById('phone').value.trim(),
                    examType: getExamTypeFromDomain(),
                    workText: document.getElementById('workText').value.trim()
                };

                console.log('Attempting to send email...', submissionData);
                const emailSent = await sendEmailNotification(submissionData);
                console.log('Email result:', emailSent);
                
                if (!emailSent) {
                    throw new Error('Failed to send email notification');
                }

                console.log('Saving to Firestore...');
                try {
                    await db.collection('submissions').doc(submissionId).set({
                        id: submissionId,
                        email: submissionData.email,
                        phone: submissionData.phone,
                        fingerprint: generateFingerprint(),
                        examType: submissionData.examType,
                        timestamp: firebase.firestore.FieldValue.serverTimestamp(),
                        status: 'emailed'
                    });
                    console.log('Firestore save successful');
                } catch (firestoreError) {
                    console.warn('Firestore save failed, but email was sent successfully:', firestoreError);
                    // Continue anyway since the email was sent
                }

                loading.style.display = 'none';
                successMessage.style.display = 'block';

            } catch (error) {
                console.error('Submission Error Details:', error);
                loading.style.display = 'none';
                form.style.display = 'block';
                submitBtn.disabled = false;
                submitBtn.textContent = 'Soumettre ma r√©ponse';
                
                // More specific error messages
                let errorMessage = 'Il y a eu une erreur lors de la soumission. ';
                if (error.message.includes('email')) {
                    errorMessage += 'Probl√®me d\'envoi d\'email. ';
                } else if (error.message.includes('firestore')) {
                    errorMessage += 'Probl√®me de sauvegarde. ';
                }
                errorMessage += 'Veuillez r√©essayer ou contactez-nous si le probl√®me persiste.';
                
                alert(errorMessage);
            }
        }

        // Update character count
        function updateCharacterCount(textareaId, countId, maxLength) {
            const textarea = document.getElementById(textareaId);
            const count = document.getElementById(countId);
            const currentLength = textarea.value.length;
            
            count.textContent = `${currentLength}/${maxLength} caract√®res (visez environ 180 mots)`;
            count.style.color = currentLength > maxLength * 0.9 ? '#e74c3c' : '#666';
        }

        // Show/clear error messages
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        function clearError(elementId) {
            const errorElement = document.getElementById(elementId);
            errorElement.style.display = 'none';
        }

        // Update submit button state
        function updateSubmitButton() {
            const form = document.getElementById('trialForm');
            const submitBtn = document.getElementById('submitBtn');
            const requiredFields = form.querySelectorAll('[required]');
            
            let allValid = true;
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    allValid = false;
                }
            });

            submitBtn.disabled = !(allValid && isPhoneVerified);
        }

        // Initialize event listeners
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('trialForm');
            const inputs = form.querySelectorAll('input, textarea');
            
            inputs.forEach(input => {
                input.addEventListener('input', updateSubmitButton);
                input.addEventListener('change', updateSubmitButton);
            });

            document.getElementById('email').addEventListener('blur', function() {
                checkPreviousSubmission();
            });

            document.getElementById('phone').addEventListener('blur', function() {
                checkPreviousSubmission();
            });

            document.getElementById('verificationCode').addEventListener('input', async function() {
                if (this.value.length === 6) {
                    await verifyCode(this.value);
                }
            });
        });
    </script>
</body>
</html>